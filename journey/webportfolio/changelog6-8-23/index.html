<!DOCTYPE html>
<html>


<link rel="stylesheet" href="/scss/main.css" />


<script src="/js/batch-load.js"></script>
 

<meta name="viewport" content="width=device-width, initial-scale=1">



<head>
 <title>Kalin Kochnev</title>
 <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
</head>
<body>
        
        <div id="content">


<link rel="stylesheet" href="/scss/main.css" />


<script src="/js/batch-load.js"></script>
 

<meta name="viewport" content="width=device-width, initial-scale=1">



<head>
 <title>Kalin Kochnev</title>
 <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
</head>

<header>  
  <nav class="navbar" role="navigation">  
    <div id="face-icon">
      





    
    <img 
        src="/images/face_hu03cb41ba356b0fd884adcc4944d0157c_969556_125x0_resize_q90_h2_box_3.webp" 
         
        

        alt=""
  
    />

      <div id="name"> 
        
        <a href="/">kalin kochnev</a>
        
      </div>  
    </div>
    
    <div id="right">  
      <a href="/journey">journeys</a>  
      <a href="/blog">blog</a>
    </div>  
  </nav>  
</header>  

<div class="single-container">
  <div class="post-page">
    <div id="post-head">
      <h1>Changelog</h1>
      <h4>Site optimization and bugfixes</h4>

      <div class="date">

        <p>June 8, 2023</p>
        <div class="tag-list">
          

          
          <span class="tag">web</span>
          
          <span class="tag">hugo</span>
          
        </div>
      </div>
    </div>

    <div class="content">
      <h1 id="improving-loading-time-with-hugo-image-processing">Improving loading time with Hugo image processing</h1>
<p>I used Hugo&rsquo;s image processing features to have all the images on my website compressed. The basic shortcode I came up with finds any global asset (stored in <code>/assets</code> instead of <code>/static</code>) or an asset in a page bundle. If you want to use a page bundle resource, make sure to pass in the <code>$.page</code> variable</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">$image</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="na">$.page</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">$.page.Resources.GetMatch</span><span class="w"> </span><span class="na">$.src</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{-</span><span class="w"> </span><span class="nx">$image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">resources</span><span class="na">.Get</span><span class="w"> </span><span class="na">$.src</span><span class="w"> </span><span class="cp">-}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nx">$image</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{</span><span class="w"> </span><span class="nx">$image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$image</span><span class="na">.Resize</span><span class="w"> </span><span class="na">$.resize</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">img</span>
</span></span><span class="line"><span class="cl">        <span class="cp">{{</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="na">$.class</span><span class="cp">}}</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="na">$.class</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;</span> <span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span> 
</span></span><span class="line"><span class="cl">        <span class="cp">{{</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="na">$.id</span><span class="w"> </span><span class="cp">}}</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="na">$.id</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;</span> <span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">        <span class="na">alt</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="nx">cond</span><span class="w"> </span><span class="o">(</span><span class="nx">isset</span><span class="w"> </span><span class="na">.Params</span><span class="w"> </span><span class="s">&#34;alt&#34;</span><span class="o">)</span><span class="w"> </span><span class="na">$.alt</span><span class="w"> </span><span class="na">$.caption</span><span class="cp">}}</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">src</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="nx">$image</span><span class="na">.RelPermalink</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="k">else</span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span> image not found :(<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></div><p>This example retrieves the global asset &ldquo;portrait2.png&rdquo; with the following directory structure.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">assets/images/
</span></span><span class="line"><span class="cl">├── face.png
</span></span><span class="line"><span class="cl">├── portrait2.png
</span></span><span class="line"><span class="cl">└── portrait.png
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">partial</span><span class="w"> </span><span class="s">&#34;imgc&#34;</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;id&#34;</span><span class="w"> </span><span class="s">&#34;portrait&#34;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;src&#34;</span><span class="w"> </span><span class="s">&#34;images/portrait2.png&#34;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;resize&#34;</span><span class="w"> </span><span class="s">&#34;1000x webp photo q50&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">)</span><span class="cp">}}</span>
</span></span></code></pre></div><p>This example retrieves an image <em>at the same level</em> as an <code>index.md</code> or <code>_index.md</code>.</p>
<h1 id="fake-primary-keys-in-hugo">Fake &ldquo;Primary Keys&rdquo; in Hugo</h1>
<figure ><div class="image-container">
        
        

        
        





    
    <img 
        src="/journey/webportfolio/changelog6-8-23/orderedlogs_huaedcae846e2a66d9842850d725a8dcb0_763609_1200x0_resize_q90_h2_box_3.webp" 
         class="batch-load"  
        

        alt=""
  
    />

    </div>
</figure>

<p>Hugo does not have any kind of ID system, which makes implementing the unordered &ldquo;log id&rdquo; feature on my journeys page unnecessarily difficult. If you were using a backend, it would be as simple as sending a query <code>SELECT * FROM Logs WHERE Project=&quot;&lt;project id&gt;&quot;</code> and iterating through the IDs of the results.</p>
<p>I couldn&rsquo;t find a better solution than iterating through every page, assign it an index, and cross reference the logs to display with their id. The code in my partial ended up looking like this</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">$indexed_logs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">$index</span><span class="o">,</span><span class="w"> </span><span class="nx">$log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="na">$.all_logs.ByDate</span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nx">in</span><span class="w"> </span><span class="na">$.log_subset</span><span class="w"> </span><span class="nx">$log</span><span class="w"> </span><span class="o">)</span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{</span><span class="w"> </span><span class="nx">$indexed_logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">append</span><span class="w"> </span><span class="nx">$indexed_logs</span><span class="w"> </span><span class="o">(</span><span class="nx">slice</span><span class="w"> </span><span class="o">(</span><span class="nx">dict</span><span class="w"> </span><span class="s">&#34;log_number&#34;</span><span class="w"> </span><span class="nx">$index</span><span class="w"> </span><span class="s">&#34;log&#34;</span><span class="w"> </span><span class="nx">$log</span><span class="o">))</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></div><p><code>$.all_logs</code> is a variable passed into the shortcode for all the logs. While <code>$.log_subset</code> are the logs we are trying to display. This code essentially appends <code>{&quot;log number&quot;: &lt;index&gt;, &quot;log&quot;: &lt;Page&gt;}</code> to a list if <code>$log</code> is going to be displayed.</p>
<h1 id="the-future">The Future</h1>
<p>I&rsquo;m hoping to improve my SEO for my posts. I haven&rsquo;t added any meta tags to anything yet.</p>

    </div>
  </div>
</div><noscript>
    <style>
        .image-container {
            opacity: 1 !important;
        }
    </style>
</noscript>
        </div><noscript>
    <style>
        .image-container {
            opacity: 1 !important;
        }
    </style>
</noscript></body>
</html>
